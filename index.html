<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site Index - GitHub Pages</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
    }
    h1 {
      border-bottom: 2px solid #0366d6;
      padding-bottom: 10px;
    }
    h2 {
      margin-top: 30px;
      color: #24292e;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
    }
    li {
      margin: 8px 0;
    }
    a {
      color: #0366d6;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    button {
      background-color: #0366d6;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 6px;
      margin-top: 10px;
    }
    button:hover {
      background-color: #0256b9;
    }
    button:disabled {
      background-color: #6a737d;
      cursor: not-allowed;
    }
    .status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
    }
    .status.error {
      background-color: #ffeef0;
      border: 1px solid #f97583;
      color: #cb2431;
    }
    .status.info {
      background-color: #f1f8ff;
      border: 1px solid #c8e1ff;
      color: #0366d6;
    }
    .status.success {
      background-color: #dcffe4;
      border: 1px solid #34d058;
      color: #22863a;
    }
    #discovered-list {
      margin-top: 15px;
    }
    .description {
      color: #586069;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Site Index</h1>
  <p class="description">Welcome to this GitHub Pages site. Below you'll find links to HTML pages hosted in this repository.</p>

  <h2>Known Pages</h2>
  <ul id="known-pages">
    <li><a href="ProductMilestone/prodmilestone_timeline_embedded.html">ProductMilestone/prodmilestone_timeline_embedded.html</a></li>
  </ul>

  <h2>Auto-Discover HTML Files</h2>
  <p>Click the button below to automatically discover all HTML files in this repository using the GitHub API.</p>
  <button id="discover-btn" onclick="discoverHtmlFiles()">Auto-discover</button>
  <div id="status"></div>
  <ul id="discovered-list"></ul>

  <script>
    async function discoverHtmlFiles() {
      const btn = document.getElementById('discover-btn');
      const statusDiv = document.getElementById('status');
      const listEl = document.getElementById('discovered-list');

      btn.disabled = true;
      btn.textContent = 'Discovering...';
      statusDiv.className = 'status info';
      statusDiv.textContent = 'Fetching repository contents...';
      listEl.innerHTML = '';

      // Extract owner and repo from the current URL
      // Expected format: https://<owner>.github.io/<repo>/
      const host = window.location.hostname;
      const path = window.location.pathname;

      let owner, repo;

      if (host.endsWith('.github.io')) {
        owner = host.replace('.github.io', '');
        // repo is the first path segment
        const pathParts = path.split('/').filter(p => p);
        // For user/org sites (username.github.io), repo is 'username.github.io'
        repo = pathParts[0] || `${owner}.github.io`;
      } else {
        // For local testing or custom domains, try to infer from meta or fallback
        statusDiv.className = 'status error';
        statusDiv.textContent = 'Unable to determine repository from URL. This feature works on GitHub Pages.';
        btn.disabled = false;
        btn.textContent = 'Auto-discover';
        return;
      }

      const htmlFiles = [];

      async function fetchContents(apiPath) {
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${apiPath}`;
        const response = await fetch(url);

        if (response.status === 403) {
          const rateLimitRemaining = response.headers.get('X-RateLimit-Remaining');
          if (rateLimitRemaining === '0') {
            throw new Error('GitHub API rate limit exceeded. Please try again later.');
          }
          throw new Error('Access forbidden. The repository may be private.');
        }

        if (response.status === 404) {
          throw new Error('Repository or path not found.');
        }

        if (!response.ok) {
          throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();

        for (const item of data) {
          if (item.type === 'file' && /\.(html|htm)$/i.test(item.name)) {
            htmlFiles.push(item.path);
          } else if (item.type === 'dir') {
            await fetchContents(item.path);
          }
        }
      }

      try {
        await fetchContents('');

        if (htmlFiles.length === 0) {
          statusDiv.className = 'status info';
          statusDiv.textContent = 'No HTML files found in the repository.';
        } else {
          statusDiv.className = 'status success';
          statusDiv.textContent = `Found ${htmlFiles.length} HTML file(s):`;

          htmlFiles.sort();
          for (const file of htmlFiles) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = file;
            a.textContent = file;
            li.appendChild(a);
            listEl.appendChild(li);
          }
        }
      } catch (error) {
        statusDiv.className = 'status error';
        statusDiv.textContent = `Discovery failed: ${error.message}`;
      }

      btn.disabled = false;
      btn.textContent = 'Auto-discover';
    }
  </script>
</body>
</html>
